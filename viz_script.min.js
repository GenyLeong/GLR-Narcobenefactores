function linechart(){var margin_top=100,margin_right=50,margin_bottom=30,margin_left=20,width=$("#container_coca").width(),height=$("#container_coca").height(),tooltip_width=100,tooltip_height=100,tooltip_x=10,tooltip_y=-30,parseDate=d3.time.format("%Y-%m-%d").parse,bisectDate=d3.bisector((function(d){return d.date})).left,dateFormatter=d3.time.format("%Y"),svg=d3.select("#container_coca").append("svg").attr("viewBox",[.5,30.5,width-30,height+30]).attr("width",width).attr("height",height-margin_top).append("g").attr("transform","translate("+margin_left+","+margin_top+")").style("pointer-events","all"),x=d3.time.scale().range([0,width]),y=d3.scale.linear().range([height-margin_top,0]),color=d3.scale.category10(),xAxis=d3.svg.axis().scale(x).ticks(5).innerTickSize(15).outerTickSize(0).orient("bottom"),yAxis=d3.svg.axis().scale(y).tickFormat((function(d){return d})).ticks(6).innerTickSize(15).outerTickSize(0).orient("left"),line=d3.svg.line().interpolate("monotone").x((function(d){return x(d.date)})).y((function(d){return y(d.price)}));d3.csv("data_coca.csv",(function(error,data){color.domain(d3.keys(data[0]).filter((function(key){return"date"!==key}))),data.forEach((function(d){d.date=parseDate(d.date)}));var companies=color.domain().map((function(name){return{name:name,values:data.map((function(d){return{date:d.date,price:+d[name]}}))}}));x.domain(d3.extent(data,(function(d){return d.date}))),y.domain([d3.min(companies,(function(c){return 0})),d3.max(companies,(function(c){return d3.max(c.values,(function(v){return v.price+100}))}))]),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(height-margin_top)+")").call(xAxis),svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Hectareas totales"),svg.append("line").attr({class:"horizontalGrid",x1:0,x2:width,y1:y(0),y2:y(0),fill:"none","shape-rendering":"crispEdges",stroke:"black","stroke-width":"1px","stroke-dasharray":"3, 3"}),svg.append("line").attr({class:"verticalGrid",x1:0,x2:0,y1:0,y2:height-margin_top,fill:"none","shape-rendering":"crispEdges",stroke:"black","stroke-width":"1px","stroke-dasharray":"3, 3"});var company=svg.selectAll(".company").data(companies).enter().append("g").attr("class","company"),path=svg.selectAll(".company").append("path").attr("class","line").attr("d",(function(d){return line(d.values)})).style("stroke",(function(d){return"Pevas"==d.name?"#8b821c":"Ram칩n Castilla"==d.name?"#546022":"San Pablo"==d.name?"#a99e22":"Yavari"==d.name?"#849249":"#9d02d7"}));parent_transition=d3.select({}).transition().duration(1e4);var circle=company.selectAll("circle").data((function(d){return d.values})).enter().append("circle").attr("r",5).style("opacity","0").style("fill",(function(d,i,j){return"Pevas"==companies[j].name?"#8b821c":"Ram칩n Castilla"==companies[j].name?"#546022":"San Pablo"==companies[j].name?"#a99e22":"Yavari"==companies[j].name?"#849249":"#9d02d7"})).on("mouseover",mousemove).on("mousemove",(function(){focus.style("display",null)})),focus=svg.append("g").attr("class","focus").style("display","none");function mousemove(c){var name;console.log(),Object.keys(companies).map((function(key,index){var datita=companies[key].values;Object.keys(datita).map((function(k,i){c.price==datita[k].price&&(name=companies[key].name)}))})),focus.attr("transform","translate("+(d3.mouse(this)[0]-150)+","+(y(c.price)-20)+")"),focus.select(".tooltip-date").text(name),focus.select(".tooltip-likes").text(d3.format(",")(c.price).toString().replace(",","."))}focus.append("text").attr("x",9).attr("dy",".35em"),focus.append("rect").attr("class","tooltip").attr("width",150).attr("height",50).attr("x",10).attr("y",-22).attr("rx",4).attr("ry",4),focus.append("text").attr("class","tooltip-date").attr("x",18).attr("y",-2),focus.append("text").attr("x",18).attr("y",18).text("Hect치reas:"),focus.append("text").attr("class","tooltip-likes").attr("x",100).attr("y",18);var totalLength=[path[0][0].getTotalLength(),path[0][1].getTotalLength(),path[0][2].getTotalLength(),path[0][3].getTotalLength()];d3.select(path[0][0]).attr("stroke-dasharray",totalLength[0]+" "+totalLength[0]).attr("stroke-dashoffset",totalLength[0]).transition().duration(5e3).ease("linear").attr("stroke-dashoffset",0),d3.select(path[0][1]).attr("stroke-dasharray",totalLength[1]+" "+totalLength[1]).attr("stroke-dashoffset",totalLength[1]).transition().duration(5e3).ease("linear").attr("stroke-dashoffset",0),d3.select(path[0][2]).attr("stroke-dasharray",totalLength[2]+" "+totalLength[2]).attr("stroke-dashoffset",totalLength[2]).transition().duration(5e3).ease("linear").attr("stroke-dashoffset",0),d3.select(path[0][3]).attr("stroke-dasharray",totalLength[3]+" "+totalLength[3]).attr("stroke-dashoffset",totalLength[3]).transition().duration(5e3).ease("linear").attr("stroke-dashoffset",0).each("end",(function(){circle.transition().attr("cx",(function(d){return x(d.date)})).attr("cy",(function(d){return y(d.price)})).style("opacity","1")}))}))}function legend(){var data_legend=[{color:"#949062",value:1184},{color:"#778248",value:1536},{color:"#849249",value:2781},{color:"#777345",value:3851},{color:"#61603a",value:4382},{color:"#546022",value:5474},{color:"#728037",value:6389},{color:"#b8ad38",value:9181}],extent=d3.extent(data_legend,d=>d.value),padding=9,width=370,innerWidth=352,barHeight=8,height=28,xScale=d3.scale.linear().range([0,352]).domain(extent),xTicks=["2000","4000","6000","8000","9000"],svg=d3.select("#legend_mapa").append("svg").attr("width",370).attr("height",28),xAxis=d3.svg.axis().scale(xScale).ticks(5).innerTickSize(15).tickValues(xTicks).orient("bottom"),g=svg.append("g").attr("transform","translate(9, 0)"),defs,linearGradient;svg.append("defs").append("linearGradient").attr("id","myGradient").selectAll("stop").data(data_legend).enter().append("stop").attr("offset",d=>(d.value-extent[0])/(extent[1]-extent[0])*100+"%").attr("stop-color",d=>d.color),g.append("rect").attr("width",352).attr("height",8).style("fill","url(#myGradient)"),g.append("g").call(xAxis).select(".domain").remove()}function wrap(text,width){text.each((function(){for(var text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=1.1,x=text.attr("x"),y=text.attr("y"),dy=0,tspan=text.text(null).append("tspan").attr("x",x).attr("y",y).attr("dy","0em");word=words.pop();)line.push(word),tspan.text(line.join(" ")),tspan.node().getComputedTextLength()>width&&(line.pop(),tspan.text(line.join(" ")),line=[word],tspan=text.append("tspan").attr("x",x).attr("y",y).attr("dy",1.1*++lineNumber+0+"em").text(word))}))}function map_rm(){var width=$("#container_mapa").width(),height=$("#container_mapa").height(),projection=d3.geo.mercator(),svg=d3.select("#container_mapa").append("svg").attr("viewBox",[.5,30.5,width-30,height+30]).attr("width",width).attr("height",height),projection=d3.geo.mercator().center([-73.7,-3.4]).scale(2500).translate([width/2,height/2]),path=d3.geo.path().projection(projection);d3.json("loreto.json",(function(error,topology){var region=svg.selectAll(".subunit").data(topojson.feature(topology,topology.objects.loreto).features).enter().append("path").attr("class",(function(d){return"subunit "+d.properties.id})).attr("d",path).on("mousemove",mousemove).on("mouseout",(function(){focus.style("display","none")})).on("mouseover",(function(){focus.style("display",null)}));svg.selectAll("text").data(topojson.feature(topology,topology.objects.loreto).features).enter().append("svg:text").text((function(d){return d.properties.NOMBPROV})).attr("x",(function(d){return path.centroid(d)[0]})).attr("y",(function(d){return path.centroid(d)[1]-20})).attr("text-anchor","middle").attr("font-size","8pt").call(wrap,30);var focus=svg.append("g").attr("class","focus").style("display","none");function mousemove(c){focus.attr("transform","translate("+(d3.mouse(this)[0]-100)+","+(d3.mouse(this)[1]-30)+")"),focus.select(".tooltip-likes").text(d3.format(",")(c.properties.ha_perdidas).toString().replace(",",".")+" ha.")}focus.append("rect").attr("class","tooltip").attr("width",140).attr("height",50).attr("x",10).attr("y",-22).attr("rx",4).attr("ry",4),focus.append("text").attr("x",18).attr("y",2).text("Hect치reas "),focus.append("text").attr("x",18).attr("y",17).text("perdidas:"),focus.append("text").attr("class","tooltip-likes").attr("x",80).attr("y",18)}))}var firstTime_1=0,firstTime_2=0;function centerDiv(that){var element,position=document.querySelector(that).getBoundingClientRect();position.top>=0&&(position.bottom,window.innerHeight),position.top<window.innerHeight&&position.bottom>=0&&("#container_coca"==that&&(0==firstTime_1&&linechart(),firstTime_1=1),"#container_mapa"==that&&(0==firstTime_2&&(map_rm(),legend()),firstTime_2=1))}$(window).on("scroll",(function(){centerDiv("#container_coca"),centerDiv("#container_mapa")})),$((function(){var current=1,max=$("li").length+1;function changeUp(){$(".slidercontent").hide(),(current+=1)===max&&(current=1),$(".slidercontent:nth-child("+current+")").fadeIn("slow")}function changeDown(){$(".slidercontent").hide(),0===(current-=1)&&(current=max-1),$(".slidercontent:nth-child("+current+")").fadeIn("slow")}function startChange(){changeIt=setInterval((function(){changeUp()}),12e3)}function stopChange(){clearInterval(changeIt)}$(".slidercontent").hide(),$(".slidercontent:nth-child(1)").fadeIn("slow"),$(".sliderspot2").click((function(){changeUp()})),$(".sliderspot").click((function(){changeDown()}))}));